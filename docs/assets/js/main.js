"use strict";const formElement=document.querySelector(".js-form"),searchBtnElement=document.querySelector(".js-searchButton"),showsContainerElement=document.querySelector(".js-showsContainer"),inputElement=document.querySelector(".js-input"),favoritesBoxElement=document.querySelector(".js-favoritesContainer");let favorites=[],series=[];function getDataFromApi(){const e=inputElement.value;fetch("http://api.tvmaze.com/search/shows?q="+e).then(e=>e.json()).then(e=>{series=[];for(let t=0;t<e.length;t++){const s=e[t].show;series.push(s)}paintSeries()})}function handleForm(e){e.preventDefault()}function handleFilter(){getFromLocalStorage(),paintFavorites(),getDataFromApi(),paintSeries()}function paintSeries(){let e,t="";for(let s=0;s<series.length;s++){const{name:i,id:r,image:a}=series[s];e=isFavoriteSerie(series[s])?"series--favorite":"",t+=`<li class="seriesCard js-seriesCard ${e}" id="${r}">`,t+='<article class="showCard js-showCard">',t+=`<h3 class="seriesTitle js-seriesTitle">${i}</h3>`,t+='<div class="imgContainer">',t+=a?`<img src="${a.medium}" class="seriesImage js-seriesImage" alt="${i}" /></a></div>`:`<img src="https://via.placeholder.com/210x295/464686/ffffff/?text=${i}" class="seriesImage js-seriesImage" alt="${i}" /></a></div>`,t+="</article>",t+="</li>"}showsContainerElement.innerHTML=t,listenSerieEvents()}function paintFavorites(){let e="";for(let t=0;t<favorites.length;t++){const{name:s,id:i,image:r}=favorites[t];e+=`<li class="seriesCard js-seriesCard" id="${i}">`,e+='<article class="showCard js-showCard">',e+=`<h3 class="seriesTitle js-seriesTitle">${s}</h3>`,e+='<div class="imgContainer">',e+=r?`<img src="${r.medium}" class="seriesImage js-seriesImage" alt="${s}" /></a></div>`:`<img src="https://via.placeholder.com/210x295/464686/ffffff/?text=${s}" class="seriesImage js-seriesImage" alt="${s}" /></a></div>`,e+="</article>",e+="</li>"}favoritesBoxElement.innerHTML=e,listenSerieEvents()}function isFavoriteSerie(e){return void 0!==favorites.find(t=>t.id===e.id)}function setInLocalStorage(){const e=JSON.stringify(favorites);localStorage.setItem("favorites",e)}function getFromLocalStorage(){const e=localStorage.getItem("favorites");if(null===e)getDataFromApi();else{const t=JSON.parse(e);favorites=t}}function listenSerieEvents(){setInLocalStorage(),getFromLocalStorage();const e=document.querySelectorAll(".js-seriesCard");for(const t of e)t.addEventListener("click",handleSerie)}function handleSerie(e){const t=parseInt(e.currentTarget.id);console.log("me han clikado",t);const s=series.find((function(e){return e.id===t})),i=favorites.findIndex((function(e){return e.id===t}));-1===i?favorites.push(s):favorites.splice(i,1),console.log(favorites),paintFavorites()}function handleInputSearch(){series=[],getFromLocalStorage(),paintFavorites(),getDataFromApi(),paintSeries()}formElement.addEventListener("submit",handleForm),inputElement.addEventListener("keyup",handleFilter),searchBtnElement.addEventListener("click",handleInputSearch);